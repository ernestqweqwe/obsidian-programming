## **Как работает JWT авторизация:**

1. **Аутентификация:**  
    Клиент → логин/пароль → сервер проверяет → генерирует `JWT`.
    
2. **Выдача токена:**  
    `JWT` отправляется клиенту (в ответе от сервера).
    
3. **Хранение:**  
    Клиент сохраняет токен:
    
    - `access-token` → в оперативной памяти (state)
        
    - `refresh-token` → в `httpOnly Secure Cookie`
        
4. **Запросы:**  
    Клиент → `Authorization: Bearer <token>` → сервер
    
5. **Проверка:**  
    Сервер проверяет подпись `JWT` (без БД, если нет blacklist) → достаёт payload
    

---

## **Из чего состоит JWT:**

Формат:

```
header.payload.signature
```

#### 1. `Header` — метаинформация

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

- `alg` — алгоритм подписи (например, HS256, RS256)
    
- `typ` — тип токена (обычно "JWT")
    

→ нужен для указания, как валидировать токен.

---

#### 2. `Payload` — данные (claims)

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022,
  "exp": 1516242622
}
```

- `iss` — кто выдал токен
    
- `sub` — идентификатор пользователя
    
- `aud` — для кого токен
    
- `exp`, `nbf`, `iat`, `jti` — контроль времени
    
- произвольные данные: `role`, `email`, и т.д.
    

→ хранит всю нужную информацию для авторизации. Не шифруется, но подписывается.

---

#### 3. `Signature` — криптографическая подпись

```text
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)
```

→ защищает токен от подделки. Любое изменение данных делает токен недействительным.

---

**Особенности и безопасность:**

✅ Stateless (без сессий на сервере)  
✅ Подпись обеспечивает целостность  
⚠️ Payload виден всем (не хранить чувствительное)  
⚠️ При краже токена — работает до `exp`  
⚠️ Подходит только при корректной реализации хранения и обновления

---

**Refresh-токен:**

- Выдаётся вместе с access-токеном
    
- Живёт дольше
    
- Хранится в `httpOnly Secure Cookie`
    
- Используется для обновления access-токена через `/refresh`
    
- Можно отозвать (через blacklist)
