
## OAuth 2.0 — схема работы и особенности

### Общее описание

OAuth 2.0 — протокол авторизации, позволяющий сторонним приложениям получать ограниченный доступ к защищённым ресурсам пользователя без передачи логина и пароля.

---

### Пример: Вход через Google в приложении LeetCode

1. Пользователь открывает приложение **LeetCode**.
2. Приложение предлагает авторизацию через Google — кнопка `Sign in with Google`.
3. После клика пользователь перенаправляется (`redirect`) на страницу авторизации **Google**.
4. В интерфейсе Google пользователь:
   - проходит аутентификацию (вводит логин/пароль)
   - подтверждает разрешения (доступ к email, профилю и др.)
5. После подтверждения Google делает `redirect` обратно в LeetCode, добавляя в URL `authorization code` или `access_token`.
6. Приложение отправляет `authorization code` на backend и получает `access_token`.
7. Теперь приложение может обращаться к **Google API** от имени пользователя с ограниченными правами.

---

### Что делает access-token

- Действителен ограниченное время (например, 1 час)
- Имеет область действия (`scopes`): доступ только к разрешённым данным
- Используется в `Authorization: Bearer <token>` для запросов к API

---

### Безопасность процесса

✅ Пользователь **не передаёт** свои логин/пароль приложению  
✅ Все конфиденциальные данные обрабатываются только Google  
✅ Пользователь может **отозвать доступ** в любой момент  
✅ **Access-токен** действует только в рамках выданных разрешений  
✅ Используется проверка `redirect_uri`, `client_id`, `state` и PKCE для защиты от атак  
✅ Можно использовать `refresh_token` для продления сессии

---

### Участники схемы

| Роль                 | Описание                                   |
| -------------------- | ------------------------------------------ |
| Resource Owner       | Пользователь (владелец данных)             |
| Client               | Приложение (например, LeetCode)            |
| Authorization Server | Google (проводит аутентификацию)           |
| Resource Server      | Google API (отдаёт данные по access-token) |

---

### Потоки OAuth 2.0 (flows)

- **Authorization Code Flow** (с сервером) — безопасный, используется в веб-приложениях
- **PKCE Flow** — для SPA и мобильных приложений, безопаснее без client_secret
- **Implicit Flow** — устарел, не используется
- **Client Credentials Flow** — для машинного доступа (без пользователя)
- **Device Code Flow** — для телевизоров и IoT-устройств

---

### Дополнительно

- `Scopes` — указывают, к каким данным пользователь разрешает доступ  
- `State` — защищает от CSRF  
- `PKCE` (Proof Key for Code Exchange) — защищает мобильные/SPA  
- `Refresh token` — обновляет access-token без повторной авторизации
